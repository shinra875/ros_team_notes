Цель: установить и использовать пакет `turtlesim` и `rqt graph` для подготовки к следующим шагам туториала

`turtlesim` - легковесный симулятор изучения роса. он демонстрирует что рос2 может делать на самом базовом уровне, разобравшись с черепахой здесь, можно перенести все знания на реальных роботов

рос2 - инструмент того, как прогер взаимодействует с роботами. может быть использован для работы с нодами (узлами), установки параметров, слушать топики и прочее. 

`rqt graph` - это графический интерфейс для работы с рос2. 

здесь рассматриваются основные концепции роса вроде нод, топиков и сервисов. все это будет более подробно рассмотрено позже. сейчас же нужно просто освоиться с базовыми инструментами

# Tasks
## 1. Install `turtlesim`
как всегда начинаем с того, что сурсим все установочные файлы. подробнее в уроке 1 [[1. Configuring environment]]
```bash
source /opt/ros/jazzy/setup.bash
```

Установим `turtlesim` в наш дистрибутив
```bash
sudo apt update
sudo apt install ros-jazzy-turtlesim
```

В случае, если у вас оно уже установлено, можно ввести следующую команду и проверить это
```bash
$ ros2 pkg executables turtlesim
>>> turtlesim draw_square
>>> turtlesim mimic
>>> turtlesim turtle_teleop_key
>>> turtlesim turtlesim_node
```
Если `turtlesim` у вас уже стоит, то выведется вот такой список исполняемых команд

## 2. Start `turtlesim`
Чтобы начать использовать черепаху, достаточно ввести эту команду
```bash
$ ros2 run turtlesim turtlesim_node
>>> [INFO] [turtlesim]: Starting turtlesim with node name /turtlesim
>>> [INFO] [turtlesim]: Spawning turtle [turtle1] at x=[5.544445], y=[5.544445], theta=[0.000000]
```
После ввода вы увидите сообщения от ноды. Там будут видны ее имя (?) и ее точка спавна
Должно открыться окно с черепахой
![[Pasted image 20251210130708.png]]

## 3. Use `turtlesim`
Откроем новый терминал и засурсим рос2 снова
А теперь запустим новую ноду для контроля черепахи в первой ноде
```bash
ros2 run turtlesim turtle_teleop_key
```
В теории, у вас уже должно быть 3 окна: 
1. терминал, где запускается `turtlesim_node`
2. терминал, где используется `turtle_teleop_key`
3. Окно черепашки

в моем случае вообще есть третий терминал: там я прочие команды могу вводить, чтобы не сломать последовательность для черепахи

разместите окна так, чтобы видеть окно черепашки и окно с `turtle_teleop_key`
Используйте стрелки на клавиатуре, чтобы контролировать черепаху. По ходу ее движения она будет оставлять след - рисунок черепахи
Нажимая стрелки, черепаха будет двигаться на короткую дистанцию и останавливаться. Это сделано для безопасности. Прикинь, огромный робот будет без остановки двигаться, а ты не сможешь/не успеешь его остановить. копец

На английской раскладке можно еще и контролировать ее абсолютный поворот
см. таблицу

| e   | r        | t   |
| --- | -------- | --- |
| d   | f - стоп | g   |
| c   | v        | b   |
попробуй самостоятельно понять, как эти кнопки отражают ее поворот :)

Можете смотреть ноды и их связанные топики, сервисы, активности используя `list` субкоманду соответствующих команд
```bash
ros2 node list
ros2 topic list
ros2 service list
ros2 action list
```
мы изучим больше об этих концепциях в будущих уроках. Сейчас мы в общем и целом обозреваем возможности `turtlesim`. Сейчас будем учиться пользоваться `rqt` для вызова сервисов `turtlesim` и взаимодействия с `turtlesim_node`

## 4. Install `rqt`
Откроем новый терминал для установки `rqt` и сопутствующих плагинов
```bash
sudo apt update
sudo apt install '~nros-jazzy-rqt*'
```
Для использования `rqt` достаточно написать одноименную команду:
```bash
rqt
```

прикольно, у меня такое впервые
![[Pasted image 20251210132822.png]]
Нажав вот здесь, попадаем в более привычный `rqt graph`
![[Pasted image 20251210132907.png]]

## 5. Use `rqt`
Когда впервые запускаешь `rqt`, окно будет пустым. не волнуемся, переходим по такому пути: **Plugins** > **Services** > **Service Caller**
![[Pasted image 20251210133104.png]]
Если вы не нашли, то что нужно, то, для начала, посмотрите еще раз, если и второй раз не получилось обнаружить искомое, то закрываем `rqt` и в терминале пишем 
```bash
rqt --force-discover
```
![[Pasted image 20251210133336.png]]
Перейдите в этот раздел, как было показано выше и нажмите кнопку перезагрузки, так будем уверены, что все сервисы и ноды теперь доступны
Зажимаем ЛКМ на выпадающем списке рядом с надписью Service и наводимся на пункт `/spawn`. 
Что это было? Нам показали все сервисы `turtlesim` 

## 5.1 Try the spawn service
Воспользуемся тем, что только что натворили. 
Можно было догадаться из названия, что `/spawn` создаст очередную черепаху в окошке черепахи (пока что нет)
Дадим новой черепахе уникальное имя, типа `turtle2` - достаточно уникально. Для этого дважды кликните в путое место на последней строке с подписью `name`. 
![[Pasted image 20251210133957.png]]
Называем
![[Pasted image 20251210133941.png]]

Видим, что тип переменной `name` - string. 
теперь зададим ей начальные координаты для спавна. например `x = 1.0; y = 1.0`
если попытаться запустить новую черепаху под именем уже существующей, то получим сообщение об ошибке от `turtlesim_node` в терминале
```bash
>>> [ERROR] [turtlesim]: A turtle named [turtle1] already exists
```
Чтобы заспавнить `turtle2` надо вызвать сервис двойным кликом сверху справа в окне `Call`
![[Pasted image 20251210134356.png]]![[Pasted image 20251210134421.png]]
УААААА, РАБОТАЕТ

Если вызов из сервиса был успешен, то увидим вторую черепаху, как выше. Стоит отметить, что координаты в окошке идут не с центра окна (0;0), а слевого нижнего угла. как стандартные 2-д ДПСК. О че помню

Если мы обновим сервис лист в `rqt`, то увидим кучу новых сервисов уже для черепахи 2
![[Pasted image 20251210134815.png]]
обрати внимание, что есть `/turtle1/set_pen` и `/turtle2/set_pen`, как пример одних команд, но для разных типочков

## 5.2. Try the set_pen service
теперь дадим `turtle1` уникальный `/set_pen` сервис
выбирай его из выпадающего списка
![[Pasted image 20251210135545.png]]
Значения `r, g, & b` - в диапазоне от 0 до 255, угадай почему :)
а значение `width` - устанавливает толщину линии
выберем цвет и ширину линии. установим `r = 255; width = 5`
не забываем вызвать сервис после этого!
чтобы увидеть результат - двигаем черепашку через `turtle_teleop_key`
причем важно понимать, что мы меняли это все для первой черепашки! как двигать вторую черепашку пока неизвестно, но скоро узнается

а, нет. цитата: "вы уже могли заметить, что нет способа двигать вторую черепаху, потому что нет teleop для `turtle2`"

## 6. Remapping
нам нужен второй teleop для контроля второй земноводной. если вы снова запустите эту же команду, то поймете, что управляете лишь первой. Мы можем изменить это поведение через ремаппинг `cnd_vel` топика

Запустим новый терминал, сурсим, запустим
```bash
ros2 run turtlesim turtle_teleop_key --ros-args --remap turtle1/cmd_vel:=turtle2/cmd_vel
```

теперь можем двигать обеими торитиллами! просто управляются они по очереди из разных терминалов
![[Pasted image 20251210140803.png]]
> Ремаппинг в робототехнике — это процесс **перенаправления или переназначения функций**, чаще всего связанный с **управлением памятью или датчиками**, чтобы оптимизировать работу, компенсировать ошибки или адаптировать робота к новым условиям, подобно тому, как в IT переназначаются сектора диска или адреса памяти, но в робототехнике это касается более сложных систем, например, **виртуальных карт, траекторий движения или сенсорных данных**, для повышения точности локализации и автономности

грубо говоря, мы перенеправили стандартную команду на конкретный объект

## 7. Close `turtlesim`
чтобы прекратить симуляцию, достаточно использовать комбинацию `Ctrl + C` в терминале `turtlesim_node` и `q` в терминалах `turtle_teleop_key`

## Вывод
Используй `turtlesim` и `rqt` в изучении основных концепций РОС2 и спина не будет болеть

## Что дальше? 
теперь, когда у нас есть базовые рабочие инструменты, можем погрузиться в главные концепции рос2
См. следующий конспект [[3. Understanding nodes]]

